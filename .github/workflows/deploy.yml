name: Deploy Translation Management System
on:
  push:
    branches: [main]
  workflow_dispatch:
  schedule:
    - cron: '*/1 * * * *'  # æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build Strapi
        run: npm run build
        env:
          DATABASE_CLIENT: sqlite
          DATABASE_FILENAME: .tmp/data.db
      
      - name: Generate translations and management interface
        run: |
          # åˆ›å»ºè¾“å‡ºç›®å½•
          mkdir -p dist/translations/zh-CN
          mkdir -p dist/translations/en-US
          
          # ç”Ÿæˆç¿»è¯‘æ–‡ä»¶
          node scripts/generate-translations.js
          
          # åˆ›å»ºç®¡ç†ç•Œé¢
          cat > dist/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-CN">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Allymatic ç¿»è¯‘ç®¡ç†ç³»ç»Ÿ</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; }
                  .container { max-width: 800px; margin: 0 auto; }
                  .header { text-align: center; margin-bottom: 30px; }
                  .translation-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
                  .key { font-weight: bold; color: #333; }
                  .zh { color: #e74c3c; }
                  .en { color: #3498db; }
                  .status { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 5px; margin: 20px 0; }
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <h1>ğŸŒ Allymatic ç¿»è¯‘ç®¡ç†ç³»ç»Ÿ</h1>
                      <p>æ‰˜ç®¡åœ¨ GitHub Pages ä¸Šçš„ç¿»è¯‘ç®¡ç†ç³»ç»Ÿ</p>
                  </div>
                  
                  <div class="status">
                      <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                      <p>âœ… ç¿»è¯‘æ–‡ä»¶å·²ç”Ÿæˆå¹¶éƒ¨ç½²åˆ° GitHub Pages</p>
                      <p>ğŸ”„ æ¯åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°</p>
                      <p>ğŸ“ ç¿»è¯‘æ–‡ä»¶ä½ç½®ï¼š<a href="./translations/">./translations/</a></p>
                  </div>
                  
                  <div class="translations">
                      <h3>ğŸ“ å½“å‰ç¿»è¯‘å†…å®¹</h3>
                      <div class="translation-item">
                          <div class="key">allymatic-All-in-One TikTok Influencer Collaboration Management System</div>
                          <div class="zh">ä¸­æ–‡ï¼šallymatic - ä¸€ç«™å¼ TikTok ç½‘çº¢åˆä½œç®¡ç†ç³»ç»Ÿ</div>
                          <div class="en">Englishï¼šallymatic - All-in-One TikTok Influencer Collaboration Management System</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">login</div>
                          <div class="zh">ä¸­æ–‡ï¼šç™»å½•</div>
                          <div class="en">Englishï¼šLogin</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">signup</div>
                          <div class="zh">ä¸­æ–‡ï¼šæ³¨å†Œ</div>
                          <div class="en">Englishï¼šSign Up</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">dashboard</div>
                          <div class="zh">ä¸­æ–‡ï¼šä»ªè¡¨æ¿</div>
                          <div class="en">Englishï¼šDashboard</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">creators</div>
                          <div class="zh">ä¸­æ–‡ï¼šåˆ›ä½œè€…</div>
                          <div class="en">Englishï¼šCreators</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">content</div>
                          <div class="zh">ä¸­æ–‡ï¼šå†…å®¹</div>
                          <div class="en">Englishï¼šContent</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">cooperation</div>
                          <div class="zh">ä¸­æ–‡ï¼šåˆä½œ</div>
                          <div class="en">Englishï¼šCooperation</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">settings</div>
                          <div class="zh">ä¸­æ–‡ï¼šè®¾ç½®</div>
                          <div class="en">Englishï¼šSettings</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">profile</div>
                          <div class="zh">ä¸­æ–‡ï¼šä¸ªäººèµ„æ–™</div>
                          <div class="en">Englishï¼šProfile</div>
                      </div>
                      <div class="translation-item">
                          <div class="key">logout</div>
                          <div class="zh">ä¸­æ–‡ï¼šé€€å‡ºç™»å½•</div>
                          <div class="en">Englishï¼šLogout</div>
                      </div>
                  </div>
                  
                  <div style="margin-top: 30px; text-align: center; color: #666;">
                      <p>ğŸ’¡ è¦æ›´æ–°ç¿»è¯‘ï¼Œè¯·ä¿®æ”¹ scripts/generate-translations.js æ–‡ä»¶å¹¶æ¨é€åˆ° GitHub</p>
                      <p>ğŸ”„ ç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ç¿»è¯‘æ–‡ä»¶</p>
                  </div>
              </div>
          </body>
          </html>
          EOF
          
          echo "âœ… ç”Ÿæˆç¿»è¯‘æ–‡ä»¶å’Œç®¡ç†ç•Œé¢å®Œæˆ"
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          force_orphan: true
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: 'Deploy translation files' 